<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23511137-1']);
            _gaq.push(['_setDomainName', '.tekuto.net']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
        <div>
            <p><a href="/">戻る</a></p>
        </div>
        <hr />
        <div>
            <h2>2014/02/10 16:20</h2>
            <p>また最初から作り直した方がいいのではないかという気持ち。</p>
            <p>＊</p>
            <p>とりあえず、fg4cppの位置付け、これ完全にミスってる気がする。</p>
            <p>fgppのインターフェースを全てC++のインライン関数にして、コード上ではfgppのインターフェースを使いつつも、実際にはfg用のプログラムができあがる、というものなんだけど。</p>
            <p>現実にはそううまくいっていない。fgでは関数ポインタにしているが、fgppでは関数オブジェクトになっているところとか、ラッピングがうまくいっていないのだ。</p>
            <p>全てインライン関数で済ましたいのだけれど、そういう関数ポインタ周りの部分には、fg4cppでインターフェースを定義し、ライブラリの方でfg4cppに対応するためのインターフェースを実装しないと使えない、といった感じだ。</p>
            <p>fg4cppを、内部的にはfgの関数を呼び出すfgppの実装の一つ、という位置付けにした方がラッパーとしてきちんとできそう。</p>
            <p>＊</p>
            <p>文字列の扱いについても、失敗してる感がすごい。</p>
            <p>文字列型は、fgにはFgString等の宣言だけで、定義は実装するライブラリに記述、という形を取っているけど、定義もfgに定めておくべきかも。</p>
            <p>定義を書いていないせいで、生成方法も実装するライブラリに関数として実装する必要があるが、その関数からログを出力したくても、ログのライブラリが文字列生成・破棄関数を使用することになるので、循環参照になってしまうため出力できないのだ。</p>
            <p>そもそも文字列型なんていうのはそう複雑であったりとか、環境によって実装がまちまちなんてものではない。</p>
            <p>文字型の配列というだけだ。加えて、長さが分かって各要素へのランダムアクセスができればそれでいい、という程度のもののはず。</p>
            <p>その型に対して、例えば文字コード変換とか複雑なことをすることはあっても、型自体は単純なはずなのだ。</p>
            <p>などなど色々言ったが、早い話が文字列型を定義してないせいで、他のライブラリに依存させたくないログのライブラリが文字列ライブラリに依存する結果になってしまっている、それはやだなぁ、ということ。</p>
            <p>＊</p>
            <p>文字列型とかいう基本データ型に修正を加えるとなると影響範囲すごいしクソめんどくさそうなので、そんくらいなら1から作るべきかなーとか。バグ作り込んでしまいそうだし。</p>
        </div>
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
    </body>
</html>
