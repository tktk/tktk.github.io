<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23511137-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-23511137-1');
        </script>
    </head>
    <body>
<!--過去ログ用
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <h1>tekuto.net</h1>
        <div>
            <p>メール:g.tekuto@gmail.com</p>
            <p><a href="http://twitter.com/tekuto" target="_blank">twitter</a></p>
        </div>
<!--テンプレート
        <hr />
        <div>
            <h2>YYYY/MM/DD hh:mm</h2>
            内容
        </div>
-->
<!-- ここまで -->
        <hr />
        <div>
            <h2>2019/01/31 15:10</h2>
            <p>記事を年単位で分割した。</p>
            <p>＊</p>
            <p>編集はvimでやってるけど、開くのに時間かかるのがいやだったので。</p>
            <p>前は月単位で分けてたけど、正直そんな頻繁に分割作業したくないので年単位にした。</p>
            <p>＊</p>
            <p>skiaに対応するために、OpenGLコンテキスト周りを修正した。</p>
            <p>skiaではステンシルバッファが必要だそうだが、現状ではステンシルバッファのサイズが0でサイズ指定もできなかったので、その辺のパラメータを設定できるようにした。</p>
            <p>また、skiaで生成した画像をテクスチャとして扱う、みたいなことをするにはskia用のコンテキストは別に用意した方がよさそうだが、その場合コンテキスト間でリソースを共有できた方がいい。</p>
            <p>なので、コンテキスト間のリソース共有もできるようにした。</p>
            <p>＊</p>
            <p>これでkasuteraの作り直しに入れるかな。</p>
        </div>
        <hr />
        <div>
            <h2>2019/01/26 03:10</h2>
            <p>skiaを使った簡単な描画処理は書けた。</p>
            <p>＊</p>
            <p>最初の生成処理はあれでいいのか不安だが、ヘッダファイルを見ても他の関数は見当たらないし、多分いいのだろう。</p>
            <p>書いてみた感じからすると、fgインターフェースにskia用の関数を追加するとか、そういうものは必要なさそうだ。</p>
            <p>バックエンドにOpenGLを使用する場合の関連付けも、カレントコンテキストに対してのみ行なわれるため、fg::GLContextに対して直接なにかしたり、といった処理は必要ない。</p>
            <p>skiaをモジュールとして扱うために、設定ファイルを追加すれば問題なく扱えそう。</p>
        </div>
        <hr />
        <div>
            <h2>2019/01/25 14:55</h2>
            <p>例の仕様変更については対応済み。</p>
            <p>＊</p>
            <p>テストについても、初期化関数を比較することで目的の画面に遷移していることを確認できるようになった。</p>
            <p>で、kasuteraを作り直そうと思ってるけど、その前にグラフィックライブラリを導入することにした。</p>
            <p>画面に表示する画像を用意するのが面倒なのだ。</p>
            <p>1つや2つで済むならいいけど、これから画面作るたびにその画面を画像を描かないといけない、というのは面倒で気が滅入る。</p>
            <p>なので、フォントファイルを参照して文字を描画したりなどできるライブラリを導入することにした。</p>
            <p>＊</p>
            <p>適当に検索かけて、まず見つけたのはcairo。</p>
            <p>このマシンにも導入されていて、ウィンドウマネージャのawesomeやwebブラウザのfirefox、chromeなどから使われているようだ。</p>
            <p>既に導入されているというのは手が出しやすくていい。</p>
            <p>更に調べていくと、skiaとかいうのも見つけた。</p>
            <p>androidやchromeの描画に使われているらしい。</p>
            <p>chromeはcairoにも依存してるんだけど、使うライブラリを切り替えたりできるんだろうか。</p>
            <p>chromeだけでなくfirefoxでも使われているようだ。</p>
            <p>cairoとはなんだったのか。</p>
            <p>＊</p>
            <p>ともかく2つのライブラリが見つかった。</p>
            <p>skiaの方が高速だの、有名なソフトウェアで使われててフィードバックが多いから開発が進んでるだのとskiaを評価する声が多いように思えるので、とりあえずskiaを使ってみようと思う。</p>
            <p>思ったのはいいのだが、skiaのサンプルコードがあまりネットに落ちてない。</p>
            <p>必死に色々調べた結果、skiaのリポジトリ内に参考になりそうなソースファイルがあった。</p>
            <p>それを見ながら、実際に動作するコードを自分で書いてみるとしよう。</p>
        </div>
        <hr />
        <div>
            <h2>2019/01/21 16:10</h2>
            <p>ちょっと詰まってる。</p>
            <p>＊</p>
            <p>画面遷移についてのテストの記述が直接的でなく、私はとても不満げだ。</p>
            <p>現状、特定の画面に遷移したかどうかのテストは、その画面で行なわれるべき動作が行なわれるか、という反応を見ている。</p>
            <p>その画面に遷移したなら、コントローラをこのように操作することでこういう結果になるはずだ、ということだ。</p>
            <p>はっきり言って回りくどく、非常に分かりづらい。</p>
            <p>テストコードがテスト可能になるまで、必要な記述も多すぎる。</p>
            <p>前述のようにコントローラ操作をテストに含めようとすると、その下準備もテストに記述する必要があるからだ。</p>
            <p>しかも、下準備を書いてなくても動作自体はしてしまう。</p>
            <p>動作するが、テストが成功することはない。</p>
            <p>実装が間違っているのか、テストの記述を間違えているのか見分けがつかず、とても不安になってしまう。</p>
            <p>＊</p>
            <p>これはとてもよくない。</p>
            <p>画面におけるコントローラ操作のテストであれば、下準備をする必要があるのでまだ分かるが、なぜ単なる画面遷移のテストでそれらをしなくてはいけないのか。</p>
            <p>大体、コントローラ操作が行なわれない画面だったら、この方法ではテストできなくなってしまう。</p>
            <p>長々と書いたが、要するにそのfg::Stateがなんの画面のfg::Stateなのか、特定する方法が存在していないのはまずい。</p>
            <p>fg::Stateに、画面を特定するためのデータを持たせる必要がある。</p>
            <p>＊</p>
            <p>テストのためだけに余計な情報を持たせる、ということはしたくないが、テスト以外でも有効に活用できそうな気はする。</p>
            <p>イベント中から画面特定データにアクセスできるようにすれば、1つのイベント関数を複数の画面で使い回し、画面ごとに処理を多少変える、といったことができるようになるだろう。</p>
            <p>そういった処理は複雑化の元だからあんまりやりたくないけど。</p>
            <p>＊</p>
            <p>で、問題は画面特定データとして何を持たせるか、だけど、fg::Stateの初期化関数のアドレスを持たせようかな、と。</p>
            <p>現状扱ってるデータで考えるとそれが妥当、というかそれしかない。</p>
            <p>fg::Stateに文字列で名前を付けるとかIDを振るとかも考えられるけど、扱いきれなくなって後悔する予感しかしない。</p>
            <p>というわけでそんな感じの修正をして、テストも修正しよう。</p>
            <p>＊</p>
            <p>いやむしろ、kasuteraについては作り直した方がいいかもしれない。</p>
            <p>kasuteraは最初テストができず、テストをできるようにするためにbrownsugarを追加し、新たに追加した画面についてはテストができている。</p>
            <p>まだあまり量書いてないし、未テスト部分にもbrownsugarを使ったテストコードを追加しようとしているけど、テストができなかった影響か構成がだめなのだ。</p>
            <p>なんとなくでコードを書いてしまい、処理は一応まともに動いているようだが関数の引数などのインターフェースが悪い。</p>
            <p>簡単に言えば扱いにくい、テストがしにくい。</p>
            <p>それを修正してまともな形にすることもできるだろうけど、いっそ最初からテストファーストでまともなものを作った方がよさそう。</p>
            <p>まだあまり量書いてないわけだし。</p>
        </div>
<!--過去ログ用
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <hr />
        <div>
            <h2>過去ログ</h2>
            <p><a href="2018.html">2018</a></p>
            <p><a href="2017.html">2017</a></p>
            <p><a href="2016.html">2016</a></p>
            <p><a href="2015.html">2015</a></p>
            <p><a href="2014.html">2014</a></p>
            <p><a href="2013.html">2013</a></p>
        </div>
<!-- ここまで -->
    </body>
</html>
