<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <link rel="stylesheet" href="style.css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23511137-1']);
            _gaq.push(['_setDomainName', '.tekuto.net']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
<!--過去ログ用
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
        <h1>tekuto.net</h1>
        <div>
            <p>メール:g.tekuto@gmail.com</p>
            <p><a href="http://twitter.com/tekuto" target="_blank">twitter</a></p>
        </div>
<!--テンプレート
        <hr />
        <div>
            <h2>YYYY/MM/DD hh:mm</h2>
            内容
        </div>
-->
        <hr />
        <div>
            <h2>2013/08/22 04:20</h2>
            <p>構成考え中。</p>
            <p>＊</p>
            <p>試しに書いて色々考えた結果、挙動は前の前に作ったライブラリと同じような感じでいいかなと思った。</p>
            <p>破棄関数で、ウィンドウが閉じるのを待機する感じ。</p>
            <p>破棄関数では強制的にウィンドウを閉じ、待機は別に関数を作った方がいいかなとも思ったんだけど、複数のスレッドで待機できるようになる以上の利点を見出せなかった。</p>
            <p>複数のスレッドで待機するとなると、待機しようとする前にオブジェクトが既に破棄されてないかも気にかけないといけないし、そもそも複数のスレッドで待機できるからどうなのだというのもあった。</p>
            <p>なので変に変えず、前に作ったのと同じでいいかーと。</p>
            <p>生成時の引数は変えることにした。前まではdp::Windowの生成にdp::WindowInfoの参照を渡し、イベントハンドラやウィンドウタイトル、幅、高さなどの情報を全てdp::WindowInfoに入れていたが、dp::WindowInfoはイベントハンドラだけ持たせることにする。</p>
            <p>dp::WindowInfoはdp::Window内にそのまま持たせ、後々参照を取得し、変更できるようにするのだが、その時にタイトルやら幅やら高さやらが変更可能になっているとどうにも妙だと感じたからだ。</p>
            <p>変更したからといって実際のウィンドウにそれが反映されるわけでもない。なので、その辺のデータはdp::Windowの生成時にdp::WindowInfoの参照とは別に渡す形にすることにした。</p>
            <p>今まで、dp::なんたらInfoとかいう、なんとも曖昧な名前な構造体をいくつも作ってしまったが、dp::なんたらEventHandlersの方がしっくりくるかもしれないな。</p>
            <p>＊</p>
            <p>ウィンドウをリサイズ不可にするとか、装飾を無くすだとか、その辺をどう実装するのかも大体まとまってきた。これなら全部書けるかもしれぬ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/20 20:40</h2>
            <p>リネームおわった。</p>
            <p>＊</p>
            <p>次はウィンドウ生成に進みたいところだけど、やるのを渋っていた理由にlinux側のAPIが、新しいのが主流になるかもしれん、というのもあったんだった。</p>
            <p>waylandかmirか。普通に考えれば前者が主流になりそうな気がするけど、どうなんだろう。</p>
            <p>どちらにせよ、X11のAPIでも使えるようにするラッパーをどちらも用意しているようなので、とりあえずはX11ので作っちゃえばいいかなぁ。新しいのを使ってみたい気もするのだけれど、どんななのか知らんし、この環境にうまくインストールできるかも分からんし。</p>
            <p>＊</p>
            <p>gitのbareリポジトリ便利ね。</p>
            <p>今まではbitbucketのリポジトリをクローンしてきて使ってたんだけど、今は別のマシンもあることだし、bareリポジトリをはさむことにした。</p>
            <p>bareリポジトリをはさむことで、途中までいじくった状態のを別のマシンからチェックアウトしてその続きの作業をしたりとか、そういうことができるようになった。</p>
            <p>今までもできなかったわけではないが、bitbucketの方に変更を送信したりしないと無理そう。中途半端なのは送信したくないしなぁ。</p>
            <p>とは言っても、別のマシンで作業する機会なんて滅多にないが。コンセントを使える喫茶店とか近くにあるなら、たまには気分転換で、そこで作業するのも悪くないとは思うのだけど。</p>
            <p>＊</p>
            <p>今気付いたが、std::unique_ptrのtypedefを統一するのやってなかったわ。やってもやらんでもインターフェース変わらんし、まぁいっかー</p>
            <p>次の作業を終えて、pushする時に含めようかな。</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/20 04:20</h2>
            <p>まだ本調子ではない。</p>
            <p>＊</p>
            <p>名前の変更、大体の方針が決まった。</p>
            <p>昨日書いたdp::Less以外にも、インスタンスの削除をdp::Freeというテンプレートファンクタでまとめることにした。</p>
            <p>処理としてはdp::free()という関数を呼び出すだけだが、オーバーロードによりdpの構造体全てに対応できる。</p>
            <p>あと、std::shared_ptrの生成をdp::shared()というテンプレート関数でまとめる。</p>
            <p>std::shared_ptrのdeleter設定はコンストラクタの第2引数であり、std::unique_ptrのようにテンプレート引数で指定することができない。そこで、各構造体ごとにdp::なんちゃらShared()という関数を用意し、deleterを設定したstd::shared_ptrを生成していた。</p>
            <p>今回、deleterをdp::Freeに統一したので、これもテンプレートで1つにまとめられる。</p>
            <p>すっきりまとめられて気分がいい。</p>
            <p>＊</p>
            <p>std::unique_ptrのtypedefも、deleterをdp::Freeに統一した関係でテンプレートを使ってより簡潔にできる。が、それにはC++11で追加されたエイリアステンプレートを使う必要があり、vs2012はそれに対応していない。vs2013で対応するらしいが。クラステンプレートを使えば同じことはできるけど、::typeとか書くのなんか嫌いなんだよなぁ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/18 22:00</h2>
            <p>色々忙しかったでした。</p>
            <p>＊</p>
            <p>関数やらファンクタやらの名前を修正している。</p>
            <p>今まで、キーデータの比較にdp::なんたらLessというファンクタを用意しておいて、それを使うことでstd::unique_ptrやらstd::shared_ptrやらでラップしたキーデータをstd::setにつっこんだりできるようにしてたんだけど、改めて見てみたら処理自体はどれも同じなわけで、dp::Lessという1つのファンクタにまとめることにした。</p>
            <p>テンプレートと関数のオーバーロードとうまく利用して、コードを簡略化できたので気分がいい。</p>
            <p>＊</p>
            <p>というのを16日辺りにやったと思うんだけど、それから今日まで色々忙しかったり疲れちゃったりしてて日記書くのおっくうになってたり、作業もできてなかったり。</p>
            <p>今日作業するのもなかなかつらい。明日から本気出すべきか。</p>
            <p>疲れすぎたらしく、食べ物の味もよく分からん。何食っても飲んでも味がしない。</p>
            <p>＊</p>
            <p>別のマシンにGUI環境入れて、uimを使った日本語入力とかもできるようにした。</p>
            <p>chromiumのビルドが失敗する。エラーメッセージを見る限り、コンパイルエラーとかではないようなのだが。ぐぬぬ</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/15 00:05</h2>
            <p>linux側のディスプレイ管理できた。</p>
            <p>＊</p>
            <p>この次はウィンドウ生成に進む予定だけど、昨日書いた通り、関数名変更を先にやってしまおう。</p>
            <p>＊</p>
            <p>1日に1回は日記を増やそうということで、最近は続けている。今日で途切れると3日坊主ってやつだ。</p>
            <p>って、ああ、日付変わっちゃってる。</p>
            <p>＊</p>
            <p>別のマシンには大体必要なものを入れた。GUI環境以外については、あとはvalgrindくらいか。今glibcをsplitdebugにして再ビルドしている。</p>
            <p>そういえば音関係入れてないな。pulseaudioを入れておくべきか。</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/13 18:50</h2>
            <p>別のマシンにgentooをインストールしながら作業。</p>
            <p>＊</p>
            <p>ちょっと外出する時とかでも、外で作業できたらいいなぁとか考えて小さいマシンを使えるようにしているんだけど、バッテリーどのくらいもつかなぁ。</p>
            <p>CPUのクロック周波数を落として省電力化、とか多分できると思うんだけどどうやるんだろう。やったことがないから調べてみないと。</p>
            <p>指紋認証機能が付いてるので、それも使えるようにしたいところではあるが、vaioだしなぁ。モジュールあるかしら。</p>
            <p>今はgcc4.8.1をemergeしている。どのくらいかかるかなぁ。10時間はかかる気がする。</p>
            <p>＊</p>
            <p>関数名、もっと単純にしてもいいかもしれないなぁ。</p>
            <p>例えばゲームパッド関係だと、dp::gamePadGetButtons()という関数を使うとゲームパッドのボタン数を取得できるが、dp::getButtons()でいいかなぁとか。</p>
            <p>別の機能で関数名が被ることがあるだろうけど、大体のものは第1引数に処理対象の構造体の参照を渡すわけで、それにより呼び出すべき関数が確定するはずだ。オーバーロードを活用する感じ。</p>
            <p>関数と構造体から成り、例外を投げない、Cっぽいライブラリにするといっても、Cに対応する気は全くないわけだし。万が一Cに対応する場合でも、ラッピングした関数を作ればいいだけだし。</p>
            <p>ディスプレイ関係の実装が済んだら変えてみようかな。</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/12 16:50</h2>
            <p>ディスプレイ管理を進めている。</p>
            <p>＊</p>
            <p>前のプロジェクトから構成を少し変更している。dp::DisplayManagerに依存させなくてもいい機能を取り外して独立させたりなど。</p>
            <p>ディスプレイの接続・切断検出機能については完了している。</p>
            <p>現在はディスプレイの解像度や配置などの情報取得処理を進めている。</p>
            <p>それが終わったら、ディスプレイの解像度や配置などの情報変更処理。</p>
            <p>＊</p>
            <p>順調だと思うのだが、やはり進みが遅い気がする。前の日記から6日も経っているではないか。</p>
            <p>モチベーションを上げるためにも、この次は音声出力ではなく、ウィンドウ生成とOpenGLを進めるべきか。</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/06 21:50</h2>
            <p>ようやくlinuxのゲームパッドのボタンやら軸やらのイベントとか対応して、linux側のゲームパッド対応は完了した。</p>
            <p>＊</p>
            <p>windows側は後回しにして、次はディスプレイ管理か音声出力か、かなぁ。前のプロジェクトで、前者は既に作ってあるし、後者は中途半端なところまで進めている。ディスプレイ管理が先かなぁ。</p>
            <p>ちなみにライブラリのサイズは以前より小さくなった。74KBくらいのが55KBくらいになった。例外クラスが無くなったからなのか、エクスポートするのがクラスではなく関数になったからなのかは分からんが。</p>
        </div>
        <hr />
        <div>
            <h2>2013/08/03 22:35</h2>
            <p>今日は、地元のお祭りに行きました。最後の花火を見て、きれいだなぁと思いました。おわり</p>
            <p>＊</p>
            <p>作り直しは着々と進行中。ペースがとろい気もするけど。</p>
            <p>文字コード変換とか、linuxのゲームパッド接続・切断検知処理とかは完了している。</p>
            <p>前よりいい構成になった気がする。#define DPIMPLEMENTとかいう、マクロ名をミスるだけでバグになるような記述も使わないようにしたし、ファイルの構成も、インターフェースと実装を完全に別にした。前は混ざっちゃってたからなぁ。</p>
            <p>オブジェクト生成時に例外投げてたのもなくした。構造体を生成し、そのアドレスを返すだけの関数にしたので、失敗時にはnullを返すだけ。その代わり、対応する破棄関数を忘れずに呼び出して破棄する必要があるが、std::unique_ptr、std::shared_ptr、std::weak_ptrのエイリアスを定義しておき、それらを使えば自動的に破棄関数が呼ばれるようにしてあるので問題はない。</p>
            <p>私としては、deleterをコンストラクタで設定するstd::shared_ptrとかあんま使う気しないんだけども。std::unique_ptrだけで十分なんじゃないかなと思っている。</p>
            <p>でもまぁ、せっかくあるのだし、定義しておいて損はないだろうとか、そんな感じ。</p>
            <p>今はまだbitbucketにpushしてないどころか、プロジェクトを作ってすらいないけど、まぁそのうち。</p>
        </div>
<!--過去ログ用
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
        <hr />
        <div>
            <h2>過去ログ</h2>
            <p><a href="201307.html">201307</a></p>
            <p><a href="201306.html">201306</a></p>
        </div>
        <div id="for-nostylesheet">
            <hr />
            <img src="images/uni.png" />
        </div>
    </body>
</html>
