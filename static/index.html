<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <link rel="stylesheet" href="style.css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23511137-1']);
            _gaq.push(['_setDomainName', '.tekuto.net']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
<!--過去ログ用
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <h1>tekuto.net</h1>
        <div>
            <p>メール:g.tekuto@gmail.com</p>
            <p><a href="http://twitter.com/tekuto" target="_blank">twitter</a></p>
        </div>
<!--テンプレート
        <hr />
        <div>
            <h2>YYYY/MM/DD hh:mm</h2>
            内容
        </div>
-->
<!-- ここまで -->
        <hr />
        <div>
            <h2>2013/11/28 03:22</h2>
            <p>OpenGL対応を進めている。</p>
            <p>＊</p>
            <p>ちょっと方針を変えるべきかもしれない。作り直しとかは必要ないんだけど。</p>
            <p>インターフェースの定義とそれを実装するライブラリ、ライブラリを運用するプログラムはそれぞれ別にしているけど、その依存関係を変えるべきかも。</p>
            <p>ライブラリとプログラムはどちらもインターフェースに依存させているが、やはりプログラムはライブラリに依存させる方がいいかもしれない。</p>
            <p>ライブラリを運用するプログラムから、ライブラリを使用するゲームを実行するわけだけど、同じインターフェースを提供すると困ることがある。</p>
            <p>基本的に、プログラムからゲームを実行するという関係からも分かる通り、プログラムはゲームより上位の存在なのだ。プログラム側ではできるけど、ゲーム側ではできない、というような処理を存在させたい。</p>
            <p>簡単に言えば、プログラム側で生成したものをゲーム側に渡し、それをゲーム側で使用して色々させたいが、生成自体をゲーム側でやらせたくないだとか、渡したものをゲーム側で勝手に破棄させたくないだとか、そういうこと。</p>
            <p>＊</p>
            <p>そのためには、そういったプログラム側でやらせたい処理のインターフェースはライブラリの中だけに存在させ、ゲーム側も利用するインターフェースには存在させない、というようなことが必要になってくる。</p>
            <p>なので、プログラムはライブラリに直接依存させた方がいいかな、と考えたわけだ。</p>
            <p>でもそれは早計かもしれない。もっと考えたら色々案が出てきた。</p>
            <p>例えば、インターフェースプロジェクトを2つに分ける。アプリ用と管理用の2つに分け、アプリ用はゲーム側が使い、アプリ用をカバーする管理用はプログラム側が使う。</p>
            <p>プロジェクトを2つに分けなくても、処理を実装するライブラリを別々にするという手もある。それが一番手っ取り早いかもしれない。</p>
            <p>で、そういうことをするとなると、今まではまぁいいかで済ませていたものも、分割するべきな気がしてきた。</p>
            <p>＊</p>
            <p>とまぁ、このようなことをなぜ考え始めたかと言えば、OpenGL対応が関わってくる。</p>
            <p>OpenGLのパラメータは、ゲーム側に設定させたくないのだ。</p>
            <p>パラメータ自体は必要であり、それを使用したOpenGLの初期化、つまりコンテキストの生成はゲーム側で自由にできるようにしたいが、パラメータの設定はゲーム側でやらせたくない。パラメータ自体は、プログラム側が生成した1つだけがあればよく、ゲーム側は生成も破棄もする必要がない。</p>
            <p>そのような要件を満たすにはどうしたらいいか考えたところ、そんな感じにする必要がありそうだな、となったわけだ。</p>
            <p>さて、どこから取り掛かろうか。</p>
        </div>
        <hr />
        <div>
            <h2>2013/11/24 04:49</h2>
            <p>linux用のウィンドウ制御できた。</p>
            <p>＊</p>
            <p>前に作ったやつは、ウィンドウのイベントを処理するスレッドとは別に描画用のスレッドを作るという、1つウィンドウ作っただけで2つのスレッドが走り出すような感じにしていたんだけど、それをやめた。</p>
            <p>ウィンドウのイベントを処理するスレッドだけにしたので、記述が単純になった。</p>
            <p>描画用のスレッドなんてのは、ライブラリ利用側でどうにかすればいいのだ。</p>
            <p>＊</p>
            <p>C言語のインターフェースのC++ラッパーを使って、動作確認用のデモを色々作っていたのだが、せっかくなのでC言語のインターフェースをC言語で直接叩いてみようかと思ったがやめた。</p>
            <p>C言語のインターフェースでは、ウィンドウのイベント処理を行なうイベントハンドラを関数ポインタでしか処理できない。そしてその関数の引数に、余分なデータはない。</p>
            <p>C++ならstd::function、ファンクタで処理する形になっているので、関数の引数以外のデータを持たせられるのだが、C言語のインターフェースではそれができないのだ。</p>
            <p>つまり、複数のイベントハンドラ間でデータを共有したり受け渡したり、といったことが、グローバル変数を使うしか方法がない、という感じになってしまっている。ごみくずである。</p>
            <p>C言語のイベント周りのインターフェースが無駄になってしまった香りがする。C/C++以外の言語に対応する場合も、多分C++のファンクタを使ったインターフェースを使うだろうし。まぁいいか。</p>
            <p>＊</p>
            <p>というわけで次は運用の方に関わってくるウィンドウ、メインウィンドウにとりかかろうと思ったが、気が早いかもしれない。</p>
            <p>だって、そんな特殊なウィンドウ作ったところで、まだウィンドウに描画できないんだもの。先にOpenGLをやっつけるべきか。</p>
            <p>OpenGLコンテキストに関係する部分は大して量がないはずだし、OpenGL関数についての部分はほぼ使い回せるはずだし。ぱぱっとやってしまうか。</p>
            <p>あ、ウィンドウを属性や位置を指定して生成する関数作ってなかった。まぁいいか。必要になったら追加しよう。メインウィンドウでサイズ固定ウィンドウが必要になるだろうし。</p>
        </div>
        <hr />
        <div>
            <h2>2013/11/23 14:42</h2>
            <p>開発は順調に進んでいる。</p>
            <p>＊</p>
            <p>構成とか、だいぶいい感じになってきている。</p>
            <p>言語別のインターフェースの定義、その実装、その運用をそれぞれ別プロジェクトに分けた。</p>
            <p>インターフェースを実装した運用プログラムであれば、その実装ライブラリがなんであろうと、動かせるような感じになっている。</p>
            <p>インターフェースの定義プロジェクトには、実装が空のソースを含んでいる。</p>
            <p>そのソースをビルドして作った動的ライブラリを使えば、実際に実装したライブラリがなくても運用プログラムの開発を行なうことができる。</p>
            <p>実装が空なので、それを使って実行してもまともに動かすことはできないが、実行時には実際に実装したライブラリをリンクすればいい。</p>
            <p>インターフェースを同一にすることで、実装と運用を完全に分離することが重要なのだ。</p>
            <p>インターフェースを定めてしまえば、その運用と実装を、完全に別々に開発することができる。</p>
            <p>＊</p>
            <p>今のところ、インターフェースプロジェクトはCとC++の2つを作っている。</p>
            <p>C++のインターフェースから、Cのインターフェースを実装したライブラリを使うためのラッパープロジェクトも作っている。</p>
            <p>Cのインターフェースは関数名の重複ができなくて扱いにくいためだ。</p>
            <p>最初からC++のインターフェースを実装したライブラリを作ればいいと思うかもしれないが、CのインターフェースをC++から利用できるように、Cのインターフェースで作っておけば他の言語から利用しやすいのだ。</p>
            <p>後々、D言語やその他の言語用のラッパーも作ろうと考えている。</p>
            <p>＊</p>
            <p>それで、今はウィンドウ周りの実装を作っている。前に作ったものを流用しているが、処理を見直して、より単純な形にした。前に作ったものは余計に作り込みすぎていた点があったのだ。</p>
            <p>それが終わったら、運用の方に関わってくるウィンドウについて作ろうと考えている。どのように実装するかは、まだもやもやしているが。</p>
        </div>
        <hr />
        <div>
            <h2>2013/11/05 19:06</h2>
            <p>dlopen()とかLoadLibrary()とかの挙動を確認した。</p>
            <p>＊</p>
            <p>linuxの.soファイルには未定義シンボルが存在していても、実行時に解決することで問題なくできるんだけど、windowsのdllはそうはいかなくて残念。</p>
            <p>LoadLibrary()を使って実行時にリンクするにしても、どの関数がなんて名前のライブラリに含まれるか、などをビルド時に確定しなければならないというのが残念だ。</p>
            <p>とはいえ、そこまできつい制約というわけでもないのでいいけど。</p>
            <p>＊</p>
            <p>ゲームを作る際に使うのはヘッダファイルだけ（windowsの場合はインポートライブラリも必要）、ヘッダファイルに記述されている関数や構造体の実体は、ゲームを起動するためのプログラムの方にライブラリとして実装する、みたいな感じで。</p>
            <p>うん、イメージできてきた。根底のインターフェースはCで用意しておいて、それをラッピングすることにより様々な言語に対応できる形にしよう。今度はちゃんとできるはずだ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/11/05 13:38</h2>
            <p>次の段階に進んで気付いたことは、どうやら構成が間違っているらしい、ということだった。</p>
            <p>＊</p>
            <p>早い話が、また作り直しである。だがその前に検証しておかなければならないことがいくつかあるので、それらを試してから。</p>
            <p>ハードウェア周りの抽象化としてdpを作り、その上にもう1つライブラリを重ねてそれ以外の機能に対応、そのライブラリとdpを使って作る、という感じをイメージしていたが、ハードウェア周りとそれ以外の機能を分けることにあまり意味がない感じがした。</p>
            <p>逆に、名前空間を分けていたりして扱いにくいのだ。</p>
            <p>よく考えたら、ライブラリの機能を使う、ゲーム部分は単体で動作できなくてもいいわけだし、そうなると機能の実装を行なうのも別の場所でいいなぁ、とか。</p>
            <p>＊</p>
            <p>そんな感じで色々考えた結果、またしてもプロジェクト作るところからやり直した方がいいんじゃないだろうか、という印象。</p>
            <p>というわけでまずは機能の検証から。</p>
            <p>＊</p>
            <p>ライブラリの名前も変える。dpの上に重ねる予定だったライブラリの名前を使うことにする。</p>
        </div>
        <hr />
        <div>
            <h2>2013/11/02 05:40</h2>
            <p>luaスクリプト見直していたら、やはりというか私が悪かったようだ。</p>
            <p>＊</p>
            <p>スクリーン切り替え処理がグローバルではなく各ウィンドウに対する処理として設定していた。</p>
            <p>ディスプレイにウィンドウが存在しないといかんというのも仕方がないというものだ。</p>
            <p>バージョンを上げることになんとか成功したので、それに合わせて修正を加えていたら気が付いた。</p>
            <p>＊</p>
            <p>とかいうのを、前の日記を書いて、起きた後に作業してたら判明したので書いていたんだけど、途中で書くのやめて今日まで忘れてた。</p>
            <p>＊</p>
            <p>どうにも、どう進めたものか、どう設計したものかイメージがまるでまとまらなかったのだけれど、ようやく見えてきた。</p>
            <p>とりあえずは、直接起動機能を作ることにした。ランチャのようなものは、それで起動したものとして実装するような感じにする。</p>
            <p>その辺から考え始めたら、ディレクトリ構成とか、起動に必要なデータとかが見えてきた。</p>
            <p>見えてきたのはいいのだが、機能を実装するとなると、その機能を実装するために必要な機能がたくさんある。</p>
            <p>完成は遠そうだなぁ。</p>
        </div>
<!--過去ログ用
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <hr />
        <div>
            <h2>過去ログ</h2>
            <p><a href="201310.html">201310</a></p>
            <p><a href="201309.html">201309</a></p>
            <p><a href="201308.html">201308</a></p>
            <p><a href="201307.html">201307</a></p>
            <p><a href="201306.html">201306</a></p>
        </div>
<!-- ここまで -->
        <div id="for-nostylesheet">
            <hr />
            <img src="images/uni.png" />
        </div>
    </body>
</html>
