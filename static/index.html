<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <link rel="stylesheet" href="style.css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23511137-1']);
            _gaq.push(['_setDomainName', '.tekuto.net']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
<!--過去ログ用
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <h1>tekuto.net</h1>
        <div>
            <p>メール:g.tekuto@gmail.com</p>
            <p><a href="http://twitter.com/tekuto" target="_blank">twitter</a></p>
        </div>
<!--テンプレート
        <hr />
        <div>
            <h2>YYYY/MM/DD hh:mm</h2>
            内容
        </div>
-->
<!-- ここまで -->
        <hr />
        <div>
            <h2>2014/01/23 14:16</h2>
            <p>イベントハンドラは基本的に複数設定できるようにするべきかもしれない。</p>
            <p>＊</p>
            <p>現在の状態では、イベントハンドラは1つしか付けられないようになっている。</p>
            <p>理由としては、簡単に言えばめんどかったからである。</p>
            <p>1つであれば、イベントハンドラが設定されているかいないか、しかない。</p>
            <p>イベントハンドラを解除する、という処理をするなら、設定されているものがあればそれを削除すればいいだけの話だ。</p>
            <p>これが複数となるとそうはいかない。どのイベントハンドラを削除するのか、とかいう話になってくる。</p>
            <p>そうなると、イベントハンドラに結び付く情報がどうとかいう話になってきて、なかなかめんどくさい。</p>
            <p>＊</p>
            <p>その辺の理由から、1つだけ付けられる形にしてきたわけだけど、1つしか付けられないとなると、複数の箇所からイベントハンドラを設定するような感じになってくると、非常に使いにくくなる。</p>
            <p>イベントハンドラを設定する、とはつまり、既存の設定を上書きしてしまうことになるわけだ。これはよくない。上書きされた側は、意図せずイベントハンドラの設定が解除されることになる。</p>
            <p>これで問題が発生しないとはとても考えられない。</p>
            <p>＊</p>
            <p>とかいうのが、ログ関係のイベントをどうするかとか、ライブラリの依存関係がどうとか考えていたら出てきた。</p>
            <p>ログライブラリは、出力するために文字コード変換が必要になるので文字列ライブラリに依存しているんだけど、それではよくないと思ったのだ。</p>
            <p>それをすると、文字列ライブラリがログライブラリに依存できず（循環参照になるため）、文字列ライブラリからログの出力ができなくなるのだ。</p>
            <p>そこで、ログライブラリは文字列ライブラリに依存させず、ログライブラリと文字列ライブラリの双方に依存する、ログ出力ライブラリというのを用意することを考えた。</p>
            <p>ログライブラリはログを受け取るインターフェースと、ログを受け取った時にイベントハンドラを呼び出すだけにして、ログの文字列変換などは行なわない。ただの橋渡しだ。</p>
            <p>ログ出力ライブラリはログライブラリにイベントハンドラを設定して、ログ発生時のイベントを受け取り、ログを文字コード変換し出力する。</p>
            <p>そこまで考えたのはいいのだが、ログのイベントハンドラが1つしか設定できないと、ログ出力だけで占有する形になってしまう。</p>
            <p>私の想定では、ログをファイルに出力しつつ、エラーログが発生した際には画面にアラートを出したりとか、そういうことをしたいのだ。そして、アラートを出すのはログ出力ライブラリの役割ではない。</p>
            <p>＊</p>
            <p>とまぁそんな感じで、イベントハンドラは1つしか設定できないようにするべきではないなぁ、という結論に至ったわけだ。</p>
            <p>なんかどんどん、JavaのAWTみたいな感じになっていく気がするが気のせいだろう。</p>
        </div>
        <hr />
        <div>
            <h2>2014/01/23 05:50</h2>
            <p>ログ出力のインターフェースはできた。</p>
            <p>＊</p>
            <p>printf()で標準出力に出力するだけのしょうもない仮実装も作った。</p>
            <p>ログを出力したら、それを別のところでイベントとして受け取り、イベントハンドラを呼び出す、とかもやりたいのだけれど、具体的にどういうインターフェースにするのかが定まっていない。</p>
            <p>なのでその辺はまだできない感じかな。</p>
            <p>とりあえずは、今までに作った箇所でログ出力が必要なところに記述を追加するとしよう。</p>
        </div>
        <hr />
        <div>
            <h2>2014/01/20 14:47</h2>
            <p>ビルド時に、バックエンドライブラリを指定できるように修正した。</p>
            <p>＊</p>
            <p>というのをやってから、またやる気減退していたがまたがんばる。</p>
            <p>設定ファイルのフォーマット定義、読み取り処理とか、C以外のプログラムの起動とか、その辺の対応をしたくはあるのだが、まだもやもやしていたために手を出せなかった。</p>
            <p>それらを作るために、まずはロガーを作ることにした。</p>
            <p>＊</p>
            <p>ロガーは、異常系にユーザが対応するための重要な要素になる。</p>
            <p>異常系に対応するための要素と言えば、例えばステータスコードのリターンとか、例外のスローとかあるけど、今回の場合どちらも不適格だと思う。</p>
            <p>基本的に、何か問題が発生したとして、自動的に何かをしなければならない、ということがないのだ。</p>
            <p>ステータスコードを返したり、例外を送出したりというのは、プログラム内でどういう問題が発生したのか判別し、発生した問題への対処を自動的に行なうためのものだ。</p>
            <p>逆に言えば、その場でプログラム内で問題に対処する必要がないのなら、成功ならtrue、失敗ならfalseで構わないと思う。</p>
            <p>ただ、それだけでは発生した問題の種類も分からず、ユーザが対応することもできない。</p>
            <p>そこでロガーというわけだ。問題が発生した時点で、それがどういう問題なのかをログとして出力する。</p>
            <p>処理の結果としては、失敗しました、エラーログを参照してください、のようなものだけ表示する。</p>
            <p>その時に、ログを参照すれば問題の原因を特定でき、対応が可能、という感じだ。</p>
            <p>＊</p>
            <p>ログ出力はほぼ全てのライブラリが利用するはずなので、できるだけ早い段階で、インターフェースだけでも定義しておくべきだろう。他のライブラリのインターフェースにも影響するからだ。</p>
            <p>そんな感じで、次はロガー対応。</p>
        </div>
        <hr />
        <div>
            <h2>2014/01/09 15:55</h2>
            <p>年末年始はのんびりしてたけど、数日前からちょびちょび再開している。</p>
            <p>＊</p>
            <p>とりあえずは、インターフェースはそのままに、実装の気になるところを修正していた。</p>
            <p>ダミー関数の定義自動生成もやっつけたし、他にも色々修正した。</p>
            <p>今まで作ったところで修正するべきところはまだあると思うが、前のプロジェクトで作った機能についてもどんどん追加していきたいところ。</p>
            <p>ひとまず、bitbucketの課題リストにつっこむところから始めるべきか。</p>
            <p>新しいプロジェクトにしてから、まだ課題リスト使ってなかったしな。</p>
        </div>
<!--過去ログ用
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <hr />
        <div>
            <h2>過去ログ</h2>
            <p><a href="201312.html">201312</a></p>
            <p><a href="201311.html">201311</a></p>
            <p><a href="201310.html">201310</a></p>
            <p><a href="201309.html">201309</a></p>
            <p><a href="201308.html">201308</a></p>
            <p><a href="201307.html">201307</a></p>
            <p><a href="201306.html">201306</a></p>
        </div>
<!-- ここまで -->
        <div id="for-nostylesheet">
            <hr />
            <img src="images/uni.png" />
        </div>
    </body>
</html>
