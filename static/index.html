<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <link rel="stylesheet" href="style.css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23511137-1']);
            _gaq.push(['_setDomainName', '.tekuto.net']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
<!--過去ログ用
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <h1>tekuto.net</h1>
        <div>
            <p>メール:g.tekuto@gmail.com</p>
            <p><a href="http://twitter.com/tekuto" target="_blank">twitter</a></p>
        </div>
<!--テンプレート
        <hr />
        <div>
            <h2>YYYY/MM/DD hh:mm</h2>
            内容
        </div>
-->
<!-- ここまで -->
        <hr />
        <div>
            <h2>2013/09/08 02:20</h2>
            <p>直したと思ったら、修正前のソースでも問題が再現しなくなったでござるの巻</p>
            <p>＊</p>
            <p>少なくとも、常にウィンドウ内全てが再描画されるというのは問題なかったようだ。</p>
            <p>てっきり、自動的にクリッピングがかかって再描画が必要な部分にのみ描画結果が適用されるものとばかり思っていたんだけど。そんなリッチな機能が最初から有効になっているはずがなかったらしい。</p>
            <p>で、初回の描画が表示に反映されない問題についても、何回やり直しても問題が再現しなくなってしまった。ぐぬぬ。</p>
            <p>修正したソースは残しておくけど、とりあえずは修正前のままでいいか。</p>
            <p>＊</p>
            <p>とまぁそんな感じで時間を無駄にしてしまったわけだが。</p>
            <p>なんかやる気減退してしまったので起きてからになるかもしれないが、OpenGL関数の扱いに入るとしよう。</p>
            <p>目指すところとしては、まずライブラリを使うプログラムが、OpenGLのライブラリ(libGL.soやらopengl32.dllやら)に直接リンクしなくてもいいということ。古いプロジェクトではwindows版のみ、opengl32.dllにリンクしなくてはならないところが気にかかっていた。環境によってはリンクしなければならない外部ライブラリがあるというのはいやだ。</p>
            <p>とりあえずはそれだけか。あとは、バージョン1.1より後の関数はglXGetProcAddress()やらwglGetProcAddress()やらを使い、文字列を引数に関数のアドレスを取得しなければならないが、関数名をプログラム側に含めさせたくないとか。そもそもそのアドレス取得の環境依存関数はプログラム側に使わせたくないな。</p>
            <p>ひとまず、OpenGLの関数は、何もしなくても使えるバージョン1.1以前の関数を含め、全て関数ポインタとして提供し、何もしなければ関数ポインタの値はnullでいいかなと思っている。</p>
            <p>そこに、なんらかのロード機構を用意し、プログラムで使用する関数のみ、関数ポインタが適切な値になるようにする、といった感じで。</p>
            <p>もちろん、環境が対応してなければ関数ポインタはnullのまま。それを利用して、プログラム側で判定を行ない描画処理に変化を持たせたりとか、後々作るシステムで、指定した関数群のポインタがnullのままだったらゲームを起動できないようにしたいなとか。</p>
            <p>引数に何を使うかが問題だ。できることなら、関数ポインタそのものを引数にしたいのだけれど、配列にできるだろうか。ほとんどの関数、型が異なるわけだしなぁ。voidのポインタとして扱えば可能か？</p>
            <p>なんにせよ、量が多いのが気が滅入る。まずはロードの必要がない関数についての処理を実装してしまって、次にロードが必要な関数についての処理を、ん、いや、逆がいいのか？後者の方が複雑そうだし、うーむ</p>
        </div>
        <hr />
        <div>
            <h2>2013/09/07 02:30</h2>
            <p>OpenGLコンテキストできた。</p>
            <p>＊</p>
            <p>コンテキスト生成とウィンドウとの関連付けを別々にしたし、垂直同期するかしないかの指定も適切な場所で行なうようにした。</p>
            <p>垂直同期に使用する関数も、ファンクタを使って呼び出し時にはif文が不要になるようにした。</p>
            <p>古いプロジェクトのよりずっとよくなっていると思う。</p>
            <p>しかし、びみょうに想定した動作をしていない。</p>
            <p>初回の描画が表示に反映されてない場合があったり、再描画時に無効領域以外も再描画してしまう、つまり常にウィンドウ内全てを再描画してたり。</p>
            <p>ウィンドウの描画イベント周りがだめなんだろうなぁ、ということがわかる。</p>
            <p>直し方のイメージはできている。</p>
            <p>かなり大幅に修正を加える必要があるが、はっきりイメージできているため途中で困ることもないだろう。</p>
            <p>だが疲れた。</p>
            <p>明日にさくっと終わらせて、OpenGL関数の扱いに入りたいところ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/09/05 18:45</h2>
            <p>新しいデモ作るのめんどいなぁ</p>
            <p>＊</p>
            <p>描画関係のイベントハンドラ対応終わらせて、再描画要求も追加した。</p>
            <p>で、マルチスレッド関係でまずいところがあったのを修正して、他にも数点修正した。</p>
            <p>これでOpenGLに入れる。のだが、まだ新しいデモ作ってない。</p>
            <p>後でもいいんじゃないかなーとか思い始めている。</p>
            <p>だって私が特に得しないし</p>
            <p>＊</p>
            <p>そんなわけでOpenGLを始めよう。まずはコンテキストからだな。</p>
            <p>古いプロジェクトで作ったやつだと、生成処理でコンテキスト生成とウィンドウへの関連付けを一緒にやってて、破棄で関連付け解除とコンテキスト破棄を一緒にやってる形になってるんだけど、コンテキストの生成・破棄とウィンドウへの関連付けは別々にした方がいい気がする。</p>
            <p>コンテキストの生成・破棄は、ウィンドウが存在していようがいまいができるからなぁ。先に生成しておいて、ウィンドウを生成してそれに関連付ける、とかそういう風にできてもいいはずだ。</p>
            <p>やったことがないから分からないけど、他のウィンドウに関連付けたコンテキストを、関連付け解除して他のウィンドウに関連付ける、とかもできるんじゃないかなぁ、多分。</p>
        </div>
        <hr />
        <div>
            <h2>2013/09/04 17:50</h2>
            <p>昨日書いた残件に、ウィンドウクローズ要求書いてなかったな。</p>
            <p>＊</p>
            <p>でもまぁ、要求系は全部終わらせたわけだ。あとは描画関係のイベントハンドラ対応を終わらせればいいだけになった。</p>
            <p>しかし、動作確認用に作っているデモが、でかくなりすぎている気がする。</p>
            <p>現時点で641行ある。行数だけならまだしも、ファンクタとか使いまくっていて、少々ではないレベルで読みにくい気がするんだよなぁ。</p>
            <p>今は、大体1ライブラリにつき1デモという感じになっているんだけど、もっと細かく分けるべきかもしれない。</p>
            <p>デモのソースを見れば、使い方が分かるような感じのを目指しているので。量や、変に複雑そうな処理で読みにくくなるのはいただけない。</p>
            <p>＊</p>
            <p>まーとりあえず描画関係のイベントハンドラ対応を終わらせよう。今あるデモにその動作確認のコードも追加するが、その後にそれとは別のデモを作ることにしよう。</p>
        </div>
        <hr />
        <div>
            <h2>2013/09/03 22:45</h2>
            <p>ウィンドウを動かした時と、サイズ変更した時のイベントハンドラ設定、呼び出し処理を追加した。</p>
            <p>＊</p>
            <p>数日、セブンスドラゴンばかりやっててほぼ進んでいなかった。おもしろいがよろしくないので自重することにした。数日というのは土日も含まれるが、まぁ関係ない。</p>
            <p>で、ウィンドウの残件は以下のような感じだと思っている。</p>
            <p>＊</p>
            <p>描画関係のイベントハンドラ対応(描画開始、描画、描画終了)</p>
            <p>ウィンドウタイトル変更要求</p>
            <p>ウィンドウ移動要求</p>
            <p>ウィンドウリサイズ要求</p>
            <p>＊</p>
            <p>こんなところか。</p>
            <p>フルスクリーンはやはり後回し。まだ描画すらできていないし、そんな状況でフルスクリーン対応しても楽しくないしなぁという意見。</p>
            <p>ウィンドウを常に最前面だとか、リサイズ不可だとか、その辺の属性？も変更できるようにするべきなのかなぁと思わないではないのだが、それさえなければ普通のウィンドウとフルスクリーンウィンドウを同じように扱えるような気がしているので、実装しない方がいいかなぁと。</p>
            <p>というか、そんなんウィンドウ作り直せばいいじゃんと思う。</p>
            <p>＊</p>
            <p>早いところ片付けて、OpenGL対応してなんか描画したい。</p>
            <p>しかし、OpenGL対応も色々考えんとなぁ。</p>
            <p>過去に作ったプロジェクトのだと、とりあえず関数呼び出せるようにすりゃいいだろという感じでやっていたが、実際には環境によって、ある関数が使えないとか使えるとかあるわけで。</p>
            <p>ゲームごとに、起動にはこの関数群が必要でそれらが使える環境じゃないとゲームを起動させることができないだとか、この関数群が使えなくてもゲームをプレイできるが、演出が地味になるかもよだとか、そういうの設定できた方がよさそう。</p>
            <p>過去に作ったやつは、OpenGLのバージョンごとにヘッダファイル分けてたけど、今回はどうしよう。結局のところバージョンなんてのは、そのバージョンで実装するべきAPIを全て実装してあればバージョン準拠を名乗れるだとかそんな感じなわけだし。</p>
            <p>しかし実際、ハードウェアはそういった括りで作られているはずなので「OpenGLのバージョンX.Xに対応してれば起動できるよ」とかいう表示の方が、起動に必要な関数名を列挙するよりずっと分かりやすそう。あるいは、詳細な情報として列挙を見られるようにするというのもありか。</p>
            <p>なんにせよ、早いところウィンドウ対応を終わらせよう。</p>
        </div>
<!--過去ログ用
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <hr />
        <div>
            <h2>過去ログ</h2>
            <p><a href="201308.html">201308</a></p>
            <p><a href="201307.html">201307</a></p>
            <p><a href="201306.html">201306</a></p>
        </div>
<!-- ここまで -->
        <div id="for-nostylesheet">
            <hr />
            <img src="images/uni.png" />
        </div>
    </body>
</html>
