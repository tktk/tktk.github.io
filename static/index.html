<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <link rel="stylesheet" href="style.css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23511137-1']);
            _gaq.push(['_setDomainName', '.tekuto.net']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
<!--過去ログ用
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <h1>tekuto.net</h1>
        <div>
            <p>メール:g.tekuto@gmail.com</p>
            <p><a href="http://twitter.com/tekuto" target="_blank">twitter</a></p>
        </div>
<!--テンプレート
        <hr />
        <div>
            <h2>YYYY/MM/DD hh:mm</h2>
            内容
        </div>
-->
<!-- ここまで -->
        <hr />
        <div>
            <h2>2014/04/30 03:47</h2>
            <p>ミニチュアを作るべきだと思った。</p>
            <p>＊</p>
            <p>肝心なところがまだもやついている。しかし、これは実際にやってみればぱっと解決する気がする。</p>
            <p>なので、まずは簡易的なミニチュアで表現し、色々試してみることにする。</p>
            <p>最初から実際のコードでやってみようとするから、躊躇したり混乱したりしてしまうのだ。</p>
        </div>
        <hr />
        <div>
            <h2>2014/04/24 01:37</h2>
            <p>想定していた設計ではどうもうまくできそうにない。</p>
            <p>＊</p>
            <p>今まで作っていた部分については、土台として問題なく使えると思うし、前に作っていた部分についても、大体そのまま使えそうなイメージはある。</p>
            <p>しかし、その中間に作るものが、どうもだめだ。</p>
            <p>根本的な思想からしてだめだった感が否めない。</p>
            <p>どう実装するかについても考慮しつつ、きちんと考え直す必要がありそうだ。</p>
        </div>
        <hr />
        <div>
            <h2>2014/04/18 17:50</h2>
            <p>wafの挙動で納得できなかった点が解決した。</p>
            <p>＊</p>
            <p>python3でwafを動かしビルドすると、変更点が無い場合でもコンパイルやリンクが走るのがなぜなのか分からなかった。python2で動かすと再現しないこともあって奇妙だった。</p>
            <p>今日、それとは別件でwscriptを修正していたら、偶然原因が判明した。</p>
            <p>どうも、python3とpython2で、セットの挙動が違うらしい。</p>
            <p>セットに文字列をつっこむ場合、同じ順序で同じデータをつっこんでも、python2の場合は常に同じ順序になるが、python3の場合は順序が変わっていることが多い。</p>
            <p>セットの性質を考えればpython3の挙動でも全然問題ないのだが、ソースファイルをセットに詰めて渡していたため、python3で動かした場合に毎回ソースファイルの順序が変わってしまい、同じコマンドだと判断されず、コンパイルやリンクが走ってしまっていたようだ。</p>
            <p>そこで、セットではなくリストに詰める形にしたところ、問題は解決した。</p>
            <p>ideoneに検証用コードを上げてリンクを張っておこうとしたのだが、なぜかideoneのpython3では再現しなかった。実装が違うのかしら。</p>
            <p>＊</p>
            <p>結局、また作り直している。どうも私の作り方は変な気がする。なんか知らんが変なところから作り始めている気がする。</p>
            <p>今回はちゃんと、先頭から順々に作っていっている。はず。呼び出す処理自体はこれまでに作った処理を大体そのまま使っている。</p>
            <p>ベースディレクトリが書かれているファイルのパスを生成し、ベースディレクトリを読み出し、まで書いた。</p>
            <p>次はベースディレクトリに配置されているコアライブラリのロード、実行。コアライブラリにはJSONパーサのようなものを搭載し、JSONで書かれた設定ファイルを読み込み、ローダライブラリをロードし、うんぬんかんぬん、のような予定。</p>
        </div>
        <hr />
        <div>
            <h2>2014/04/03 22:50</h2>
            <p>dlopen()とLoadLibrary()らへんの違いを確認した。</p>
            <p>＊</p>
            <p>結論から言うと、実現は容易いが少しめんどうだ。</p>
            <p>linuxの共有ライブラリは、ビルド時に依存する共有ライブラリをリンクしなくてもビルドできる。</p>
            <p>一方、windowsの動的ライブラリは、ビルド時に依存する動的ライブラリをリンクしなければビルドできない。</p>
            <p>linuxにおいて、dlopen()を使って共有ライブラリを実行中にロードする場合、対象のライブラリが依存している共有ライブラリはLD_LIBRARY_PATHの環境変数が示すパスに存在していなければならない。</p>
            <p>windowsにおいて、LoadLibrary()を使って動的ライブラリを実行中にロードする場合、対象のライブラリが依存している動的ライブラリはどこかに存在していなければならない、ということはない。</p>
            <p>＊</p>
            <p>今作っている複数のライブラリの中には、作っている別のライブラリに依存しているものも多いが、このライブラリはLD_LIBRARY_PATHなどの環境変数が示す場所に置いておくつもりはない。</p>
            <p>なので、linux用にビルドする場合には、依存ライブラリを指定せずにビルドし、実行中に自分でライブラリの依存関係を解決し、ロードする必要がある。</p>
            <p>ビルド時に依存ライブラリを指定してしまうと、ロード時にこけてしまう。</p>
            <p>windows用にビルドする場合は、実行中については同様だが、ビルド時には指定しないとこけてしまうため、依存ライブラリを指定しなければならない。</p>
            <p>＊</p>
            <p>私が作っているライブラリの生成時にだけ影響するというのならいいのだが、ここで言うライブラリというのは、ゲーム自体のプログラムも含まれる。</p>
            <p>つまり、ライブラリを利用する側の、存在するかもしれない私以外の開発者にも、そのようなルールを強いなければならないわけだ。なかなか心苦しいものがある。</p>
            <p>どうしようもないことではあるのだが。</p>
        </div>
        <hr />
        <div>
            <h2>2014/04/03 04:15</h2>
            <p>前の日記から1ヶ月ほど空いてしまった。</p>
            <p>＊</p>
            <p>えらくローペースながら、進んではいる。コマンドライン引数の処理をして、その引数を元にゲームを起動しようとするところまで書けた。</p>
            <p>しかしこの部分については、後々変更することになりそうだ。今の状態は、あくまで一時的なもの。</p>
            <p>ゲームをロードする仕組みらへんについても大体考えがまとまってきたし、悪くはない感じ。</p>
            <p>ただちょっとやる気が出にくいのと体調がよくなりにくいのが気になるところ。</p>
        </div>
<!--過去ログ用
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <hr />
        <div>
            <h2>過去ログ</h2>
            <p><a href="201402.html">201402</a></p>
            <p><a href="201401.html">201401</a></p>
            <p><a href="201312.html">201312</a></p>
            <p><a href="201311.html">201311</a></p>
            <p><a href="201310.html">201310</a></p>
            <p><a href="201309.html">201309</a></p>
            <p><a href="201308.html">201308</a></p>
            <p><a href="201307.html">201307</a></p>
            <p><a href="201306.html">201306</a></p>
        </div>
<!-- ここまで -->
        <div id="for-nostylesheet">
            <hr />
            <img src="images/uni.png" />
        </div>
    </body>
</html>
