<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>tekuto.net</title>
        <link rel="stylesheet" href="style.css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-23511137-1']);
            _gaq.push(['_setDomainName', '.tekuto.net']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
<!--過去ログ用
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <h1>tekuto.net</h1>
        <div>
            <p>メール:g.tekuto@gmail.com</p>
            <p><a href="http://twitter.com/tekuto" target="_blank">twitter</a></p>
        </div>
<!--テンプレート
        <hr />
        <div>
            <h2>YYYY/MM/DD hh:mm</h2>
            内容
        </div>
-->
<!-- ここまで -->
        <hr />
        <div>
            <h2>2013/10/23 17:00</h2>
            <p>読み書き追記、大体対応できた。</p>
            <p>＊</p>
            <p>readにwrite、seek、tellに対応したので、読み書き、ファイルポインタの移動、現在位置取得ができるようになったわけだ。</p>
            <p>しかし、あと1つだけ対応できてない機能がある。truncateだ。</p>
            <p>＊</p>
            <p>truncateの機能は切り捨て、切り詰めだ。ファイルを指定した長さに切り詰め、以降のデータを存在しないものにする。</p>
            <p>この機能を使えない場合に同じことをするなら、1度ファイルの内容を全て読み込み、fopenのモード指定でwやw+を指定することでファイル内容をクリアし、切り詰めない部分を書き込む、などという感じのことをしなければならない。なんともめんどくさい。</p>
            <p>しかし、実際に用意されている機能は、切り詰めた後の長さを指定するだけのもので、微妙に信頼性に欠けている。</p>
            <p>どういうことかと言えば、現在のファイルよりも長い長さを指定することも可能なのだ。その場合、増えた部分には\0の文字で埋められるか、エラーが発生するかする。</p>
            <p>エラーが発生するかどうかは、ファイルシステムに依存するらしい。XSIとかいう仕様に従っているらしい、linuxのネイティブなファイルシステムでは確実に伸長されるようだが、例えばvfatのような、非ネイティブなファイルシステムではエラーになり、伸長されないらしい。</p>
            <p>通常linuxでvfatを使うことなどあまりない、と言いたいところだが、例えばUSBメモリなどのリムーバブルメディアのファイルシステムは大体vfatのはずだ。なんにせよ、ファイルシステムによって失敗する可能性のある処理というのは面倒なものだ。</p>
            <p>そもそも、truncateは切り詰めるための機能であり、伸長するための機能ではないのだ。失敗する可能性があるところからして、おまけと考えるべきだろう。伸長したいなら書き込めばいいのだ。</p>
            <p>＊</p>
            <p>というわけで、伸長を許可しないインターフェースを用意したいところなのだが、どうしたものか。</p>
            <p>例えば、削りたい長さを指定して、その長さ分末尾から切り詰める、というものを思い付いたが、正直使いやすそうとは思えない。</p>
            <p>その長さを算出するためには、切り詰めた後の長さと切り詰める前の長さを把握してなければならないからだ。</p>
            <p>win32APIには<a href="http://msdn.microsoft.com/ja-jp/library/cc429774.aspx" target="_blank">SetEndOfFile()</a>というものがあるが、これはファイルポインタの現在位置まで切り詰める、というものだ。</p>
            <p>しかし説明を見れば分かる通り、ファイルポインタをファイルの終端より後の地点に移動させておけば伸長も可能な作りになっている。別にファイルポインタは、始端と終端の範囲内しか指せないという決まりはないため、そこでは縛りを作れない。</p>
            <p>あるいは、truncateのインターフェースはそのままで、伸長は推奨しない、という形にするのもありか。とりあえずそれでいこう。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/21 04:50</h2>
            <p>おかしい。完成してない。おかしい。</p>
            <p>＊</p>
            <p>18日の日記、直前の日記には、今日中にはlinux側の実装を片付けてしまいたいところなんて書いてあるのだが、未だ出来ていない。おかしい。</p>
            <p>その理由の1つとして、若干やる気が削がれているというのがある。なんでだろう。</p>
            <p>なんでだか分からないがやる気というのは出るものではなく出すものというのが私の意見であるので、今現在出ていない理由なんていうのは割とどうでもいいのだが。</p>
            <p>2つ目の理由として、予想していたよりもややこしいことになっている、というのがある。</p>
            <p>ファイル入出力は、前の日記に書いた通り、読み込み用に開いたなら書き込み関数の呼び出しがコンパイルエラーになる、書き込み用に開いたなら読み込み関数の呼び出しがコンパイルエラーになる、という仕様にしようと考えている。</p>
            <p>しかしながら現実的には、用意されているAPIにそのような制約が存在しないパターンがほとんどだ。</p>
            <p>開くとファイルポインタが得られ、それを使って読み込み関数を呼び出せば読み込み処理が行なわれ、書き込み関数を呼び出せば書き込み処理が行なわれる。オープン時の読み込み、書き込み指定と処理が合致していなかったりした場合、エラーとなり処理は失敗する。大体そんなもんだ。</p>
            <p>そのようなAPIを使って今回の要件を満たすならば、内部的にはどのような開き方をしても読み込み、書き込みの両方を行なえるようにしておき、型によって可能な処理を縛る、というような感じになる。</p>
            <p>今まで作ってきた機能よりも、環境が異なっても変える必要がない、処理を共通化できる箇所が増えたため、それを考慮した構成になるよう、コードを組むのに苦心している、といったところか。</p>
            <p>あまりに考えすぎると、やる気がどんどん削がれていくのだ。考えすぎると手が出なくなってしまうわけだ。</p>
            <p>＊</p>
            <p>まー、起きたらやっつけるとしよう。寝る前に、どこから攻めるかまとめておくとしよう。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/18 14:40</h2>
            <p>ファイル入出力機能を追加している。</p>
            <p>＊</p>
            <p>大きなファイルの扱いについての対応がOSごとに違ったと思うので、その辺を共通のインターフェースで扱えないときつい。</p>
            <p>linuxはfopen()と似たような感じでfopen64()とかの関数が用意されているが、windowsは全く別の名前の関数がwin32APIに用意されていた気がする。</p>
            <p>＊</p>
            <p>fopen()などが、読み込み専用で開いたファイルに対して、失敗するとはいえfwrite()などの書き込み用関数を使える仕様なのが、私としては気に食わない。</p>
            <p>なので、読み込み専用で開いたのなら書き込み用関数を呼び出せず、書き込み専用で開いたのなら読み込み用関数を呼び出せない、呼び出そうとしてもコンパイルエラーになるような構成にしようと思っている。</p>
            <p>無論、読み書き可能で開いた場合には読み書きどちらの関数も呼び出せるようにする。</p>
            <p>大体の構成はすでにイメージできているので、今日中にはlinux側の実装を片付けてしまいたいところ。</p>
            <p>＊</p>
            <p>作業用の環境はlinuxなんだけど、今はvmware上で動いているため、まともにOpenGLとか使うならwindowsなんだよなぁ。</p>
            <p>しかしwindows側は仮実装状態だらけで、すべて実装するのはなかなか手間だ。</p>
            <p>私としては早いところ上位ライブラリの作成に移りたいのだけど、肝心のその構成はまだ定まっていない。</p>
            <p>上位ライブラリは実際に動くプログラムが必要とする機能を追加していく形になるのだから、ライブラリより先にプログラムの方を進めるべきなんだろうか。</p>
            <p>とりあえずファイル入出力をやっつけよう。話はそれからだ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/17 05:40</h2>
            <p>グラボのlinux用プロプライエタリドライバは基本的にゴミクズ</p>
            <p>＊</p>
            <p>作者に悪いだなんて思わないむしろ迷惑被った私に謝れ。</p>
            <p>高速な3D描画が行えたとしても、まず安定しなきゃ意味がないのだ。</p>
            <p>linux用のプロプライエタリドライバがまともなことなんてほとんどなかった。</p>
            <p>初めて自作したマシンにインストールした時、64bitOSなのにnvidiaのドライバときたらメインメモリが4GBより多く積まれていると起動に失敗した。</p>
            <p>startxする段階だったかOSの起動の段階だったかは忘れたが、確実にフリーズするのだ。64bit用のドライバなのに64bitに対応していないらしかった。</p>
            <p>そのせいで、マシンをまともに使うというためだけにatiのグラボを購入したことがある。</p>
            <p>＊</p>
            <p>またある時nvidiaのグラボを使っていたら、マルチディスプレイでの利用時に奇妙なことに気がついた。</p>
            <p>OpenGLでの3D描画を行うプログラムを作った時、サブディスプレイでそのプログラムを表示すると、CPUの1コアの使用率が100%になってしまうのだ。</p>
            <p>垂直同期を有効にしているにも関わらず、メインディスプレイでは垂直同期が効くのにサブディスプレイでは垂直同期が効いていなかったのだ。</p>
            <p>＊</p>
            <p>atiのドライバもだめだめだ。</p>
            <p>最近というか今さっきまで起こっていたことだが、安定板のドライバを使っていると、ウェブブラウザのGPUアクセラレーションが使われるタイミングで、非常に高い確率でフリーズする。</p>
            <p>そうでなくとも、dmesgを見るとドライバモジュールが頻繁にBUGという文字列を出力している。</p>
            <p>ベータ版のドライバを使ってみたところウェブブラウザ程度で高確率でフリーズすることはなくなったが、flashやjavascriptでの描画が真っ黒になったりちらついたりということが頻繁に発生する。</p>
            <p>フリーズも高確率ではなくなっただけで発生する。</p>
            <p>これは確証はないのだが、ターミナルソフトのサーバプログラムにも影響を及ぼし、サーバプログラムが勝手に死んでしまうということも起きた。どうもフォントの描画処理らへんのライブラリとの相性がよくないように思える。</p>
            <p>ターミナルのサーバプログラムが死ぬと、開いているターミナルは全ておじゃんになる。非常に迷惑だ。</p>
            <p>＊</p>
            <p>で、結局、私はnvidiaやatiのドライバを使うのをやめた。今は仮想マシンをwindows上のvmwareで動かしている。</p>
            <p>OpenGLは2.1ぐらいまでしか使えないようだが、特に不便はない。ターミナルの透過処理も全く問題なくできているし、動画再生を行なっても全く支障がない。</p>
            <p>マルチスクリーンを全て使って、vmware上でない、直接起動した時と全く同じ表示にできるし。安定した環境というのはいいものだ。</p>
            <p>やる気がなくソースが公開されてないので誰も修正できないソースから作られたものなど、所詮どうしようもないものでしかないということらしい。</p>
            <p>＊</p>
            <p>vmwareのオープンソースドライバも全部が全部公開されてるのかしらんけども。</p>
            <p>atiのグラボ用のオープンソースドライバとかもあったが、びみょうに残念だったな。画面の回転ができなかったのだ。</p>
            <p>将来的には可能になるようなのだが、私はサブディスプレイを縦向きにしているため、回転できないと困る。いずれじゃ困るんだ。いるのは今だ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/15 15:10</h2>
            <p>gentooの32bit chroot環境の構築も完了した。</p>
            <p>＊</p>
            <p>前の環境にはclangとか入れてたっけ。今は入れてないが、使う機会がまだないからいいだろう。</p>
            <p>＊</p>
            <p>pulseaudioのpa_threaded_mainloopをpa_mainloopに置換できるかどうか試したが無理だった。</p>
            <p>複数のpa_mainloopは生成できないらしい。しようとするとエラーが出て落ちる。</p>
            <p>グローバル変数を使ったクソ実装の香りがする。</p>
            <p>結局、動いているから今は触らない方がいい気がしてきた。</p>
            <p>改良するなら、もはやpulseaudio以外を使うくらいしかない。</p>
            <p>しかし、pulseaudioの作りが奇妙すぎていらいらする。</p>
            <p>たかが音声を再生するために、</p>
            <ul>
                <li>pa_threaded_mainloopを作って</li>
                <li>pa_threaded_mainloopからpa_mainloop_apiを取得して</li>
                <li>pa_mainloop_apiからpa_contextを作って</li>
                <li>pa_contextからpa_streamを作る</li>
            </ul>
            <p>こんな感じ？pa_threaded_mainloopとかpa_mainloop_apiとかpa_contextとかってなんやねん。それって本当に必要か？</p>
            <p>出力先デバイスの指定はpa_stream生成時に行なうのに、ロックの単位はpa_threaded_mainloopだし。まさかとは思うがデッドロックを回避するためとかほざくんだろうか。</p>
            <p>まぁいいや。これ以上考えても頭が痛くなるだけだ。</p>
            <p>＊</p>
            <p>音声出力オブジェクトをポーズ状態で生成する関数を追加したら、そろそろ次のステップに移ってもいい気がする。</p>
            <p>しかし、イベントハンドラの差し替え機能とかいらないんじゃないかなぁなどと、今更になって考えている。</p>
            <p>そんな機能が必要なら、ライブラリ利用側で勝手に用意すればいいのだ。</p>
            <p>イベントハンドラの差し替えなんかしない場合、イベントハンドラ呼び出し時に毎回std::unique_lockかけるのなんて無駄だしなぁ。</p>
            <p>差し替えないなら、イベントハンドラ取得関数なんてのも無駄になるし。省いてしまおう。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/10 22:00</h2>
            <p>gentooの起動が問題なくなった。</p>
            <p>＊</p>
            <p>うまくいかなかったのは、GPTなハードディスクについてのマウントポイント指定をUUID=で/etc/fstabに記述していたのがいけなかったのかな、という気がする。</p>
            <p>blkidで出力した結果にはPARTUUID=と書いてあったのに、見慣れないからというだけで、多分大丈夫だろうと思いUUID=にしてしまったのだ。PARTUUID=にしたら問題なくなった。</p>
            <p>気がついたら問題なく起動できるようになっていたため、それを直したら直ったのか、直した後もだめだったのかなんなのかはわからない。</p>
            <p>少なくともカーネルモジュールの組み込みについては、修正する必要がなかった。</p>
            <p>＊</p>
            <p>あと、UEFIモードで起動した場合に何も表示されない問題も解決した。</p>
            <p>正確にはコンソールが出ないだけであり、Xは問題なく動作していたが。</p>
            <p>UEFIモードは最初からフレームバッファが動作しているらしく、それに関係するモジュールを組み込んでおき、フレームバッファコンソールに対応していないといけなかった、ということらしい。</p>
            <p>試行錯誤を繰り替えした結果、以下のモジュールをカーネルに組み込んでおけば問題ないことが分かった。</p>
            <ul>
                <li>CONFIG_FB_EFI ( Device Drivers &gt; Graphics support &gt; Support for frame buffer devices )</li>
                <li>CONFIG_FRAMEBUFFER_CONSOLE ( Device Drivers &gt; Graphics support &gt; Console display driver support )</li>
            </ul>
            <p>どちらかもしくは両方がなかったり、モジュールになっていたりすると、コンソールが出なくなる。initramfsで読み込んでもいいのかもしれないが未検証。</p>
            <p>＊</p>
            <p>あとは、efibootmgrに地味に苦しめられた。</p>
            <p>マザボ、というよりはUEFIに依存すると思うが、初期状態ではエントリの一覧表示ができなくて困った。</p>
            <p>先頭のエントリしか表示されず、表示されないエントリについてブートオーダーを変更しようとしたり、エントリの削除などを行おうとしても失敗してしまう。</p>
            <p>解決策は、一度エントリを追加し、追加したエントリを削除する。これで問題なくなった。</p>
            <p>いや、最初からまともに動いてください。困るので。</p>
            <p>efibootmgrでブートオーダーをいじくっていたからなのかはわからないが、UEFIからして起動しなくなってしまったりもした。原因は特定できていないが、CMOSクリアをかければ問題なく起動するようになる。厄介な。</p>
            <p>ちなみにマザボはASRock 990FX Extreme4。</p>
            <p>＊</p>
            <p>これでOSのインストールやら起動やらは問題なくなった気がする。しかしながら、gentooへのソフトのインストールが不完全だ。32bitプログラムの動作環境も整えていない。</p>
            <p>multilibでなければならない64bitプログラムがなくなったので、nomultilibにしてしまったのだ。emulライブラリとか気に食わんのでいいんだけど、chroot環境の構築めんどいなぁ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/10 03:50</h2>
            <p>環境構築し直していた。</p>
            <p>＊</p>
            <p>UEFIモードでOSをインストールし直した。</p>
            <p>windows8はインストールが完了しているが、gentooの方は不完全。</p>
            <p>windows8上で動作するVMwarePlayerでなら起動するが、単体では起動できていないっぽい。</p>
            <p>ぽい、というのは、画面に何も出力されないからわからないのだ。</p>
            <p>カーネルの設定がおかしいのか、なにかツールが足りないのか、起動後ずっと何も表示されない。</p>
            <p>windows8上で動作するVMwarePlayerでも同じく何も表示されないのだが、GUIを使うつもりがないので一応問題ない。</p>
            <p>sshで接続して作業したり、sambaの共有フォルダにアクセスする程度なので支障が出ないのだ。</p>
            <p>しかし、起動にこけたりしたら原因を特定できないので、早くどうにかしないと。</p>
            <p>表示が問題ないインストールディスクで使ってるものと、ほぼ同じ設定ファイルを使ってビルドしたカーネルでもだめだった。</p>
            <p>ほぼ同じ、というだけで、initramfsが不要な形に修正しているのが原因かもしれない。</p>
            <p>あるいは、initramfs内のスクリプトに答えがあるのかもしれない。</p>
            <p>とにかくめんどうだ。UEFIモードにしたおかげで起動直後のポスト画面の表示時間が短縮され、起動が速くなったのはいいのだけど。</p>
            <p>あと、UEFIモードにしたおかげで、gentooの起動にGRUBなどのブートローダがいらなくなった。UEFIスタブとかいうやつで、カーネル単体で起動できる。</p>
            <p>これ以上時間食いたくないなぁ。作業に戻りたい。</p>
            <p>だがしかしgentooの単体起動が。ぐぬぬ。</p>
            <p>起動開始直後に、ハードディスクのアクセスランプが少し点滅した後すぐ反応なくなるところから考えると、/のマウントに失敗しているのだろう。</p>
            <p>/のマウントに必要な機能をカーネルに含めれば、最終的にディスプレイマネージャが立ち上がってログインできるようになると思うのだけど。</p>
            <p>インストールディスクで起動してlspciすれば解決する予感がするがめんどくさいのだ。</p>
            <p>＊</p>
            <p>グラボを新しくするべきか考え中。</p>
            <p>具体的には、グラボをultra fast boot対応のものにしようかなぁと考えている。</p>
            <p>ultra fast bootにしたマシンを起動する動画を見たが、休止状態やスリープなどからでない通常の起動で、電源投入から5、6秒で操作可能な状態になるので、かなり速い。</p>
            <p>しかし、現状でもwindows8のシステムドライブをSSDに変更したこともあり、起動速度は十分な気がする。</p>
            <p>起動速度とわずかなパフォーマンス向上のために、1万払うのはなんだかなぁ、という気持ち。</p>
            <p>＊</p>
            <p>gentooのUEFIモードでのインストールには、SystemRescueCdを使った。</p>
            <p>公式のインストールディスクがUEFIモードでの起動に対応していないので仕方がない。</p>
            <p>ていうか、SystemRescueCd自体がgentoo。公式のインストールディスクに毛が生えたようなもの。</p>
            <p>startxって打てばX起動するし、GParted使ってGUIでパーティションいじくれるし。</p>
            <p>UEFIモードでの起動に加えてgdiskやefibootmgrも入っているので、UEFIモードでのインストールも問題ない。</p>
            <p>USBメモリも作成できるので、作っておくと便利。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/07 14:20</h2>
            <p>ようやく環境が整ってきた感。</p>
            <p>＊</p>
            <p>ホストOSをwindowsにできるようにしていた。簡単に言えばgentooとwindows8のデュアルブート環境にした。</p>
            <p>しかし、ただデュアルブートにするだけではOS間のデータ共有が面倒だったりと、不便なことになってしまうので、少し工夫した。</p>
            <p>ホストOSがwindowsの場合、vmwareplayerを使ってgentooを仮想マシンとして起動できるようにした。</p>
            <p>起動するgentooはデュアルブートで起動できるものと全く同じ。仮想マシンのディスクに物理ディスクを割り当て、起動できるようにした。</p>
            <p>sambaやsshが入っているので、samba経由でデータを共有したり、sshでログインして作業したりもできる。</p>
            <p>windows側にはcygwinを入れてあるので、cygwinにXサーバを追加すればGUIプログラムも起動できたりするんだろうか。</p>
            <p>まぁさすがに、linux用のdpをいじったりする場合には、gentooを直接起動しようと思うけど。</p>
            <p>＊</p>
            <p>そんなわけで、windows用のdp開発環境が整ったわけだ。</p>
            <p>ここ数日環境構築に費やしてしまったので、早く開発に戻りたいところ。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/02 22:30</h2>
            <p>マウスも対応した。</p>
            <p>＊</p>
            <p>vmwareにつっこんだgentooは、割といい感じに動いている。</p>
            <p>open-vm-tools-kmodのインストールは、カーネルを3.9系のものにすることで対応した。</p>
            <p>「複数のモニタを循環する」とかいう、何言ってんのか分からない機能を使うことで、複数のモニタにフルスクリーン表示することができていい感じ。</p>
            <p>OpenGLも使えたが、想定通りというか、おまけっぽい印象を受けた。とりあえず、深度バッファが機能していないっぽかった。あるいは、プログラムの方がいけないのかもしれない。深度バッファのサイズ指定してなかったかも。</p>
            <p>そうでなくても、OpenGL2.1ぐらいまでしか対応しないようなので、期待はできない。</p>
            <p>とりあえずブラウザや動画プレイヤーをインストールしてみて、どんな感じで動作するのか確認する。</p>
            <p>vmware上でgentooを動かしているマシンはCPUがintel-vtに対応してないcore2quadなので、amd-vに対応したメインマシンではどうなることやら。性能上がるといいんだけど。</p>
            <p>ああ、あとグラボもよくなる。メーカーからして違うが、げふぉのローエンドかららでおんのミドルエンドになる。</p>
            <p>intel-vtに対応していないせいで、32bit版のgentooを入れるはめになったが、メインマシンには64bit版を入れる予定。</p>
            <p>＊</p>
            <p>32bitのマシンでdpをビルドして分かったことは、OpenGLの定数をenumで定義するのはびみょうだということだ。unsigned long longな値とかあるせいで、コンパイルエラーになる。</p>
            <p>enumではなくconst autoにしたら通ったので、後で直しておこう。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/02 05:20</h2>
            <p>とりあえずキーボード対応した。</p>
            <p>＊</p>
            <p>windows側、うまくできるか不安。</p>
            <p>＊</p>
            <p>そんなことより、仮想マシンにつっこんでるwindowsがまれによくホスト巻き込んでフリーズして参ったので、ホストをwindowsにしようかと思っている。</p>
            <p>まず、すでにwindowsが入っているマシンにvmwareを入れて、その上にgentooをインストールして色々試してみることにする。</p>
            <p>しかし、VMWarePlayer、バージョン5かららしいが、バルーンヒントが消せない。</p>
            <p>「お使いのコンピュータに戻るには、Ctrl+Altを押してください」とかいうのが毎回出てきてうざい。</p>
            <p>それが出てるところクリックしても、その下をクリックしたことにならないし邪魔なことこの上ない。</p>
            <p>前のバージョンを使えるようなら変えてしまおうかしら。</p>
            <p>＊</p>
            <p>あと、vmware toolsのインストールがうまくいかない。</p>
            <p>gentooのリポジトリにopen-vm-toolsとかいうのがあるので、それをインストールしようとしているのだが、open-vm-tools-kmodのインストールでこける。</p>
            <p>どうやら、新しいカーネルに対応していない記述になっているらしい。</p>
            <p>ちょっと検索してみたら対応するためのパッチが見つかったので使おうとしたが、どうも古いバージョンのvmware tools用らしくパッチが失敗する。</p>
            <p>すごいめんどくさい。しかしやらねば。どう対応しよう。古いカーネルのソースからカーネルを構築しようかしら。それが一番楽そう。</p>
        </div>
        <hr />
        <div>
            <h2>2013/10/01 04:00</h2>
            <p>細かい修正をしていた。</p>
            <p>＊</p>
            <p>そう細かくないこともしてたけど。インターフェース変えたり。</p>
            <p>ウィンドウやディスプレイの幅、高さ、位置などのデータをdp::Long（long long型）やdp::ULong（unsigned long long型）にしてたのをやめた。dp::Int（int型）で統一した。</p>
            <p>理由としては、幅や高さをOpenGLで使用する場合に不便だから。それに、幅や高さの指定に64bit整数が必要になることなんて、絶対にないなんてことはないだろうけど、まぁすぐには必要にならんだろう。</p>
            <p>パソコンのディスプレイの解像度なんか、1920x1080とかいうクソみたいなのが主流のようだし。横長やめろよテレビじゃねぇんだぞ。</p>
            <p>＊</p>
            <p>あと、linuxの場合のみだが、dp_commonのロード時、アンロード時に行なっていたXOpenDisplay()やXCloseDisplay()の呼び出しを、別のライブラリ（dp_xlib）に分離した。</p>
            <p>dp_windowやdp_displayなどで必要になるので、共通的なdp_commonのロード時、アンロード時に処理させてたんだけど、dp_commonはdpを使用するプログラムに必須。コマンドライン引数の処理からしてdp_commonの関数を使ってるし。</p>
            <p>なので、dp_windowやdp_displayなどを使わないプログラムであっても、XOpenDisplay()やXCloseDisplay()が呼び出されることになってしまう。そんな無駄なことはしたくないので、別のライブラリに分離して、それをdp_windowやdp_displayなどから参照する、という形にした。</p>
            <p>＊</p>
            <p>そんな感じか。この次はキーボードとマウスの対応を行なう。</p>
            <p>キーボードの対応がうまくできる気がしなかったので今まで敬遠してたんだけど、風呂入ってる時にいいアイデアが浮かんだので試すことにする。起きたら。</p>
            <p>＊</p>
            <p>そういえばpulseaudioの利用周りを修正するみたいなこと言ってたけど、想像以上に無茶そうなのでやめた。</p>
            <p>オブジェクトの破棄時にもロックする必要があるとか困る。std::unique_ptrで対応できないじゃないか。</p>
            <p>ああ、あるいはpa_threaded_mainloopではなくpa_mainloopにすればよかったんかな。キーボードとマウスを対応したら試してみるか。</p>
        </div>
<!--過去ログ用
        <hr />
        <div>
            <p><a href="/">戻る</a></p>
        </div>
-->
<!-- ここから過去ログ時に削除 -->
        <hr />
        <div>
            <h2>過去ログ</h2>
            <p><a href="201309.html">201309</a></p>
            <p><a href="201308.html">201308</a></p>
            <p><a href="201307.html">201307</a></p>
            <p><a href="201306.html">201306</a></p>
        </div>
<!-- ここまで -->
        <div id="for-nostylesheet">
            <hr />
            <img src="images/uni.png" />
        </div>
    </body>
</html>
